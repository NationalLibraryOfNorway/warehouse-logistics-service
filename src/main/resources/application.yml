# Main configuration for Hermes application
spring:
  application:
    name: Hermes
  lifecycle:
    timeout-per-shutdown-phase: 15s
  profiles:
    default: pipeline
  http:
    codecs:
      max-in-memory-size: 1000KB

  kafka:
    retry:
      topic:
        enabled: true
        attempts: 5
        backoff:
          delay: 5s
          multiplier: 2
    template:
      default-topic: hermes-mythos
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

  # Security — env vars required in stage/prod, defaults for local
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_ISSUER_URI:http://localhost:8082/realms/mlt-local}
          audiences: ${KEYCLOAK_TOKEN_AUD:http://localhost:8080}

  mail:
    host: ${EMAIL_SERVER:localhost}
    port: ${EMAIL_PORT:1025}
    properties:
      mail:
        smtp:
          connectiontimeout: ${TIMEOUT_SMTP:8000}
          timeout: ${TIMEOUT_SMTP:8000}
          writetimeout: ${TIMEOUT_SMTP:8000}

  mongodb:
    uri: ${MONGODB_URI:mongodb://wls:slw@localhost:27017/wls?replicaSet=rs0&authSource=wls}

server:
  port: 8080
  shutdown: graceful

management:
  endpoints:
    web:
      base-path: /actuator
      exposure:
        include: prometheus,health,info
  endpoint:
    health:
      show-details: always
      access: read_only
  server:
    port: 8888

springdoc:
  server-url: ${SWAGGER_SERVER_URL:http://localhost:8080}
  api-docs:
    path: /hermes/api-docs
  swagger-ui:
    path: /hermes/swagger
  show-actuator: false

logging:
  level:
    no.nb.mlt.wls: debug
    web: debug

callback:
  secret: ${CALLBACK_SECRET:superdupersecretkey}

synq:
  path:
    base: ${SYNQ_BASE_URL:http://localhost:8181/synq/resources}

kardex:
  enabled: ${KARDEX_ENABLED:true}
  path:
    base: ${KARDEX_BASE_URL:http://localhost:8182/kardex}

logistics:
  enabled: ${LOGISTICS_ENABLED:true}

wls:
  order:
    handler:
      email: ${ORDER_HANDLER_EMAIL:daniel@mlt.hermes.no}
    sender:
      email: ${ORDER_SENDER_EMAIL:hermes@mlt.hermes.no}

timeout:
  mongoTimeout: ${TIMEOUT_MONGO:8}
  inventoryTimeout: ${TIMEOUT_INVENTORY:10}
  storageTimeout: ${TIMEOUT_STORAGE:10}

proxy:
  http-proxy-host: ${HTTP_PROXY_HOST:localhost}
  http-proxy-port: ${HTTP_PROXY_PORT:3128}
  non-proxy-hosts: ${HTTP_NON_PROXY_HOSTS:localhost|127.0.0.1|docker}

---

spring:
  config:
    activate:
      on-profile: stage|prod

  kafka:
    retry:
      topic:
        enabled: true
        attempts: 5
        backoff:
          delay: 5s
          multiplier: 2
    template:
      default-topic: hermes-mythos
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_ISSUER_URI}
          audiences: ${KEYCLOAK_TOKEN_AUD}

  mail:
    host: ${EMAIL_SERVER}
    port: ${EMAIL_PORT}
    properties:
      mail:
        smtp:
          connectiontimeout: ${TIMEOUT_SMTP}
          timeout: ${TIMEOUT_SMTP}
          writetimeout: ${TIMEOUT_SMTP}

  mongodb:
    uri: ${MONGODB_URI}

springdoc:
  server-url: ${SWAGGER_SERVER_URL}

callback:
  secret: ${CALLBACK_SECRET}

synq:
  path:
    base: ${SYNQ_BASE_URL}

kardex:
  enabled: ${KARDEX_ENABLED}
  path:
    base: ${KARDEX_BASE_URL}

logistics:
  enabled: ${LOGISTICS_ENABLED}

wls:
  order:
    handler:
      email: ${ORDER_HANDLER_EMAIL}
    sender:
      email: ${ORDER_SENDER_EMAIL}

timeout:
  mongoTimeout: ${TIMEOUT_MONGO}
  inventoryTimeout: ${TIMEOUT_INVENTORY}
  storageTimeout: ${TIMEOUT_STORAGE}

proxy:
  http-proxy-host: ${HTTP_PROXY_HOST}
  http-proxy-port: ${HTTP_PROXY_PORT}

---

# Production profile — only overrides what differs
spring:
  config:
    activate:
      on-profile: prod

logging:
  level:
    no.nb.mlt.wls: info
    web: info
